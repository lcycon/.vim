class HomeController < ApplicationController
  #before_filter :authenticate_user!
  
  def index
  end

  def new
    datetime = params[:date]
    @numbers = params[:numbers] || "+16263155355"

    @datetime = datetime.to_datetime

    @numbers = @numbers.split(',')
    @numbers.collect! { |n| n.strip }
    Resque.enqueue(NotifySMSJob, @numbers, @datetime)
    Resque.enqueue_at(@datetime, CallJob, @numbers)

    redirect_to root_path
  end

  def start_conference  # build xml for conference details

    @xml = Twilio::TwiML::Response.new do |r|
      r.Dial :callerID => '+16198666555', :record => 'true' do |d|
        d.Conference 'MyConference'
      end
    end
    
    respond_to do |format|
      format.xml { render :xml => @xml.text}
    end
  end

  protected

  def authenticate
    authenticate_or_request_with_http_basic do |username, password|
      username == "tmtmtm" && password == "foobar1"
    end
  end
end
